"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},34101:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>_,originalPathname:()=>w,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>h});var s={};r.r(s),r.d(s,{POST:()=>POST}),r(78976);var i=r(10884),o=r(16132),a=r(24596),n=r(74658),p=r(69363),u=r(28761);async function POST(e){let t;let r=await e.text(),s=(0,a.headers)().get("Stripe-Signature");try{if(!n.O.STRIPE_WEBHOOK_SECRET)throw Error("STRIPE_WEBHOOK_SECRET is not configured");t=u.A.webhooks.constructEvent(r,s,n.O.STRIPE_WEBHOOK_SECRET)}catch(e){return new Response(`Webhook Error: ${e.message}`,{status:400})}let i=t.data.object;if("checkout.session.completed"===t.type){let e=await u.A.subscriptions.retrieve(i.subscription);await p.db.user.update({where:{id:i?.metadata?.userId},data:{stripeSubscriptionId:e.id,stripeCustomerId:e.customer,stripePriceId:e.items.data[0].price.id,stripeCurrentPeriodEnd:new Date(1e3*e.current_period_end)}})}if("invoice.payment_succeeded"===t.type){let e=await u.A.subscriptions.retrieve(i.subscription);await p.db.user.update({where:{stripeSubscriptionId:e.id},data:{stripePriceId:e.items.data[0].price.id,stripeCurrentPeriodEnd:new Date(1e3*e.current_period_end)}})}return new Response(null,{status:200})}let d=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/webhooks/stripe/route",pathname:"/api/webhooks/stripe",filename:"route",bundlePath:"app/api/webhooks/stripe/route"},resolvedPagePath:"/Users/samhenry/patriot-heavy-ops/patriot-heavy-ops/app/api/webhooks/stripe/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:x,headerHooks:_,staticGenerationBailout:h}=d,w="/api/webhooks/stripe/route"},69363:(e,t,r)=>{let s;r.d(t,{db:()=>i}),s=new(r(53524)).PrismaClient;let i=s},28761:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(80420),i=r(74658);let o=new s.Z(i.O.STRIPE_API_KEY||"",{apiVersion:"2022-11-15",typescript:!0})}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[6889,4596,4933,420,4658],()=>__webpack_exec__(34101));module.exports=r})();